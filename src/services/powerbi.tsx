import _ from "lodash"
import { NodeIface } from "@/schemas/node";
import { getSession } from "./session";

export const getToken = async (dataset: string, report: string) => {
   return fetch('https://api.powerbi.com/v1.0/myorg/GenerateToken',
      {
         method: 'POST',
         headers: {
            'Content-type': 'application/json',
            'Authorization': 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkNOdjBPSTNSd3FsSEZFVm5hb01Bc2hDSDJYRSIsImtpZCI6IkNOdjBPSTNSd3FsSEZFVm5hb01Bc2hDSDJYRSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvMTAzMTQ4OGEtYWUxZC00MmY5LWEwYmYtMDVlNzc1MTE0NmVhLyIsImlhdCI6MTc0ODYxNDk3NywibmJmIjoxNzQ4NjE0OTc3LCJleHAiOjE3NDg2MTkwNjcsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBVVFBdS84WkFBQUFpSXFLZTlaR2txRXBMOEVrQ3pZcng2N053aUdOVUlVaWNBZXlnWFNadG5ZK0Jyc2k3dWM2WHJIZjZWdExxUGhCK1pTM1d0YnBXRGxkN0F6YmVYZVZIdz09IiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6IjE4ZmJjYTE2LTIyMjQtNDVmNi04NWIwLWY3YmYyYjM5YjNmMyIsImFwcGlkYWNyIjoiMCIsImZhbWlseV9uYW1lIjoiQ2FiZXJvIiwiZ2l2ZW5fbmFtZSI6IkVyaWMiLCJpZHR5cCI6InVzZXIiLCJpcGFkZHIiOiI4NS44Ny4wLjEyOCIsIm5hbWUiOiJFcmljIENhYmVybyIsIm9pZCI6ImQzMzViNTI2LTA5MWUtNGI0Ni05N2YwLWU4ZGI1ODA3NTZiZiIsInB1aWQiOiIxMDAzMjAwMzI3N0NBMTBDIiwicmgiOiIxLkFhNEFpa2d4RUIydS1VS2d2d1huZFJGRzZna0FBQUFBQUFBQXdBQUFBQUFBQUFDckFKMnVBQS4iLCJzY3AiOiJBcHAuUmVhZC5BbGwgQ2FwYWNpdHkuUmVhZC5BbGwgQ2FwYWNpdHkuUmVhZFdyaXRlLkFsbCBDb25uZWN0aW9uLlJlYWQuQWxsIENvbm5lY3Rpb24uUmVhZFdyaXRlLkFsbCBDb250ZW50LkNyZWF0ZSBEYXNoYm9hcmQuUmVhZC5BbGwgRGFzaGJvYXJkLlJlYWRXcml0ZS5BbGwgRGF0YWZsb3cuUmVhZC5BbGwgRGF0YWZsb3cuUmVhZFdyaXRlLkFsbCBEYXRhc2V0LlJlYWQuQWxsIERhdGFzZXQuUmVhZFdyaXRlLkFsbCBHYXRld2F5LlJlYWQuQWxsIEdhdGV3YXkuUmVhZFdyaXRlLkFsbCBJdGVtLkV4ZWN1dGUuQWxsIEl0ZW0uRXh0ZXJuYWxEYXRhU2hhcmUuQWxsIEl0ZW0uUmVhZFdyaXRlLkFsbCBJdGVtLlJlc2hhcmUuQWxsIE9uZUxha2UuUmVhZC5BbGwgT25lTGFrZS5SZWFkV3JpdGUuQWxsIFBpcGVsaW5lLkRlcGxveSBQaXBlbGluZS5SZWFkLkFsbCBQaXBlbGluZS5SZWFkV3JpdGUuQWxsIFJlcG9ydC5SZWFkV3JpdGUuQWxsIFJlcHJ0LlJlYWQuQWxsIFN0b3JhZ2VBY2NvdW50LlJlYWQuQWxsIFN0b3JhZ2VBY2NvdW50LlJlYWRXcml0ZS5BbGwgVGFnLlJlYWQuQWxsIFRlbmFudC5SZWFkLkFsbCBUZW5hbnQuUmVhZFdyaXRlLkFsbCBVc2VyU3RhdGUuUmVhZFdyaXRlLkFsbCBXb3Jrc3BhY2UuR2l0Q29tbWl0LkFsbCBXb3Jrc3BhY2UuR2l0VXBkYXRlLkFsbCBXb3Jrc3BhY2UuUmVhZC5BbGwgV29ya3NwYWNlLlJlYWRXcml0ZS5BbGwiLCJzaWQiOiIwMDUwZTcwOS1iMTgwLWI2NjQtYzJjMy04MWZkZTlmYWEwNjQiLCJzdWIiOiJWSkVyWGlFSnFibG4yZlFibnJfWHJDd2FkMTdpVklzd0NXMnN0eVk5OHh3IiwidGlkIjoiMTAzMTQ4OGEtYWUxZC00MmY5LWEwYmYtMDVlNzc1MTE0NmVhIiwidW5pcXVlX25hbWUiOiJlcmljLmNhYmVyb0Bob3Jub3NwdWpvbC5jb20iLCJ1cG4iOiJlcmljLmNhYmVyb0Bob3Jub3NwdWpvbC5jb20iLCJ1dGkiOiJPWWlVQWlsQzlVcTR0WkxVd0E2ZkFBIiwidmVyIjoiMS4wIiwid2lkcyI6WyJiNzlmYmY0ZC0zZWY5LTQ2ODktODE0My03NmIxOTRlODU1MDkiXSwieG1zX2Z0ZCI6ImllSWhkOXlVRU11MjVJUXZIUXZJUGd0WUNHdnZQdDRfNDN5YUZtdlFkODBCWlhWeWIzQmxibTl5ZEdndFpITnRjdyIsInhtc19pZHJlbCI6IjEgMjAifQ.M-bC64wX78i_Div2eXfNrRPAp_vZUMwOxb_k4lVQned-CiUxTRTxXcXuPyBjjoAj4vK1tBFEDYaVhPmibMIzgN8IX_bM1GS8w5zENEemluWqMkjHijDDIOK2MFRWtCfZzxhcBDa-vYMl3rb_1dJEW_d9k5_WX8WOrZpxiKqXCLvUfllFGjXsZ6kZtG4QZNCA8IthxO6B6qIA_kUcgwRqmgNXb4txobrFejArrqev6qVNsBSTRfO79vj1azKATashZQklfQtBc3NvvQSSg17gm4UbeF7UnDuelPlgLitlj_X5feeQMnmABqKSZMV0EVbnXPvwbp8YK6s60_LQQud1kQ'
         },
         body: JSON.stringify(
            {
               'datasets': [
                  {
                     'id': dataset
                  }
               ],
               'reports': [
                  {
                     'allowEdit': true,
                     'id': report
                  }
               ]
            }
         )
      }).then(res => res.json());
}

export const getEmbedUrl = async (groupId: string, reportId: string) => {
   return fetch(`https://api.powerbi.com/v1.0/myorg/groups/${groupId}/reports/${reportId}`,
      {
         method: 'GET',
         headers: {
            'Content-type': 'application/json',
            'Authorization': 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkNOdjBPSTNSd3FsSEZFVm5hb01Bc2hDSDJYRSIsImtpZCI6IkNOdjBPSTNSd3FsSEZFVm5hb01Bc2hDSDJYRSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvMTAzMTQ4OGEtYWUxZC00MmY5LWEwYmYtMDVlNzc1MTE0NmVhLyIsImlhdCI6MTc0ODYxNTk2MSwibmJmIjoxNzQ4NjE1OTYxLCJleHAiOjE3NDg2MjExMDUsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBVVFBdS84WkFBQUFwMTR3OGJrdlcvUCt5Z3Y3cURFOVVDUWFLbDdSSS9lMjNZQUNrWGxIMGRqMytUNjZaeld4Rm9BN0R4NlRJT1RuTG1HY0lwMkpSNUZFVnJ2TStHUkVhdz09IiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6IjE4ZmJjYTE2LTIyMjQtNDVmNi04NWIwLWY3YmYyYjM5YjNmMyIsImFwcGlkYWNyIjoiMCIsImZhbWlseV9uYW1lIjoiQ2FiZXJvIiwiZ2l2ZW5fbmFtZSI6IkVyaWMiLCJpZHR5cCI6InVzZXIiLCJpcGFkZHIiOiI4NS44Ny4wLjEyOCIsIm5hbWUiOiJFcmljIENhYmVybyIsIm9pZCI6ImQzMzViNTI2LTA5MWUtNGI0Ni05N2YwLWU4ZGI1ODA3NTZiZiIsInB1aWQiOiIxMDAzMjAwMzI3N0NBMTBDIiwicmgiOiIxLkFhNEFpa2d4RUIydS1VS2d2d1huZFJGRzZna0FBQUFBQUFBQXdBQUFBQUFBQUFDckFKMnVBQS4iLCJzY3AiOiJBcHAuUmVhZC5BbGwgQ2FwYWNpdHkuUmVhZC5BbGwgQ2FwYWNpdHkuUmVhZFdyaXRlLkFsbCBDb25uZWN0aW9uLlJlYWQuQWxsIENvbm5lY3Rpb24uUmVhZFdyaXRlLkFsbCBDb250ZW50LkNyZWF0ZSBEYXNoYm9hcmQuUmVhZC5BbGwgRGFzaGJvYXJkLlJlYWRXcml0ZS5BbGwgRGF0YWZsb3cuUmVhZC5BbGwgRGF0YWZsb3cuUmVhZFdyaXRlLkFsbCBEYXRhc2V0LlJlYWQuQWxsIERhdGFzZXQuUmVhZFdyaXRlLkFsbCBHYXRld2F5LlJlYWQuQWxsIEdhdGV3YXkuUmVhZFdyaXRlLkFsbCBJdGVtLkV4ZWN1dGUuQWxsIEl0ZW0uRXh0ZXJuYWxEYXRhU2hhcmUuQWxsIEl0ZW0uUmVhZFdyaXRlLkFsbCBJdGVtLlJlc2hhcmUuQWxsIE9uZUxha2UuUmVhZC5BbGwgT25lTGFrZS5SZWFkV3JpdGUuQWxsIFBpcGVsaW5lLkRlcGxveSBQaXBlbGluZS5SZWFkLkFsbCBQaXBlbGluZS5SZWFkV3JpdGUuQWxsIFJlcG9ydC5SZWFkV3JpdGUuQWxsIFJlcHJ0LlJlYWQuQWxsIFN0b3JhZ2VBY2NvdW50LlJlYWQuQWxsIFN0b3JhZ2VBY2NvdW50LlJlYWRXcml0ZS5BbGwgVGFnLlJlYWQuQWxsIFRlbmFudC5SZWFkLkFsbCBUZW5hbnQuUmVhZFdyaXRlLkFsbCBVc2VyU3RhdGUuUmVhZFdyaXRlLkFsbCBXb3Jrc3BhY2UuR2l0Q29tbWl0LkFsbCBXb3Jrc3BhY2UuR2l0VXBkYXRlLkFsbCBXb3Jrc3BhY2UuUmVhZC5BbGwgV29ya3NwYWNlLlJlYWRXcml0ZS5BbGwiLCJzaWQiOiIwMDUwZTcwOS1iMTgwLWI2NjQtYzJjMy04MWZkZTlmYWEwNjQiLCJzdWIiOiJWSkVyWGlFSnFibG4yZlFibnJfWHJDd2FkMTdpVklzd0NXMnN0eVk5OHh3IiwidGlkIjoiMTAzMTQ4OGEtYWUxZC00MmY5LWEwYmYtMDVlNzc1MTE0NmVhIiwidW5pcXVlX25hbWUiOiJlcmljLmNhYmVyb0Bob3Jub3NwdWpvbC5jb20iLCJ1cG4iOiJlcmljLmNhYmVyb0Bob3Jub3NwdWpvbC5jb20iLCJ1dGkiOiJXMlowUEdyZGZFdU1IY3JjdmpNeEFBIiwidmVyIjoiMS4wIiwid2lkcyI6WyJiNzlmYmY0ZC0zZWY5LTQ2ODktODE0My03NmIxOTRlODU1MDkiXSwieG1zX2Z0ZCI6IjZmUFBKU1JGb3ZEQmFVekJGMDdOOGlDNllFQ1BqaGpRN2F4TVg5NlBveGNCWlhWeWIzQmxkMlZ6ZEMxa2MyMXoiLCJ4bXNfaWRyZWwiOiIxIDYifQ.eZ8Jx4tFFJ10dfVtRDLAyU3vpbM5dTs7Buvog3HShvQBekJFvBcK4KJ_IKRQGPdIJ8_ZdjPeqjCdSjoQrHFFN-vs6g-RL745XvAVL61jwwrkUtUHMrNZMYaHuKc_kF-SYTIkkfRWLWN1Nojes_VQ1IhQWkln-3lgN6LFeczK_ZcTdKdLiKq9lH7vCfkaU1y-PBxP9vIfZSPljTYyFkdTshXrsfSvQXLlBWVfTgTOWZUdrRbQCHeoADB_R2ypQS94zT6kRplPWw8vKEbazx52tbYEG6LZnJrCcOKj3UoIcDl8QTdUYGZNQUv_v5nntJfX75Fc6Igj7IeZJOAMEp7iNg'
         }
      }).then(res => res.json());
}